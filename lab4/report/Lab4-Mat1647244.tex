\documentclass[draft]{homework}

\usepackage{xspace}

\newcommand{\intfw}{\texttt{intfw}\xspace}
\newcommand{\kat}{Kathar√°\xspace}
\newcommand{\mainfw}{\texttt{mainfw}\xspace}
\newcommand{\opn}{OPNsense\xspace}
\newcommand{\vb}{VirtualBox\xspace}


\title{Practical Network Defense - Lab 4}
\author{Alessandro Serpi - 1647244}
\date{22 March 2019}


\begin{document}
    \maketitle
    \tableofcontents
    
    
    \section{Introduction}
    \fxnote{TODO}
    
    
    \section{Setup of the infrastructure}
    \subsection{Disabling checksum offload}
    The command \texttt{ethtool -K eth0 tx off} was added to every \texttt{.startup} file. This disables the checksum computation offload to the network card; instead, the hosts rely on the CPU to calculate the packet checksums. It is slower, but creates less problems with \opn.
    In \opn, the checksum offload is disabled by default.
    
    \subsection{Enabling recursive DNS queries}
    Recursive DNS queries are not permitted, but this clashes with the fact that client hosts are allowed to retrieve web pages from the internet. Therefore, it has been decided to allow recursive DNS queries adding the clause \texttt{recursion yes;} in \texttt{dns/etc/named.conf}, section \texttt{options}.
    
    It has also decided that hosts in the DMZ and in the internal server network may be interested in retrieving IP addresses of external websites. Hence, recursive DNS queries have been allowed for the whole private network.
    
    \subsection{Creating and configuring the VMs}
    Create in \vb two virtual machine, one for \mainfw and the other for \intfw, each with its own disk. Download the ISO installer from \opn's \href{https://opnsense.org/download/}{official website} and add it to the virtual machines. \href{https://docs.opnsense.org/manual/install.html}{Install} \opn in both machine, then power them off and remove the ISO.
    
    Start the lab, then run the script \texttt{confgure.sh}\footnote{it requires root privileges}. The script assigns a client IP to the host and creates a valid route to the internal network. In this way, the host acts like a client when connecting to the internal network. Using the output of the script, configure the virtual machines as follows: in \mainfw, assign a NAT connection to the first network interface, DMZ to the second and Firewalls to the third; in \intfw, assign Firewalls to the first network interface, Server to the second and Client to the third. These steps must be repeated every time the lab restart, as \kat changes the bridge names every time.
    
    \subsection{Configuring the interfaces}
    Power up both virtual machine, login as root and enter interface assignment menu. Use \texttt{em0} as WAN, \texttt{em1} as OPT1 and \texttt{em2} as LAN.
    
    Enter the IP address configuration menu. In \mainfw, configure WAN to use DHCP, assign 100.64.254.1/30 to LAN and 100.64.6.1/24 to OPT1; in \intfw, assign address 100.64.254.2/30 and gateway 100.64.254.1 to WAN, address 100.64.2.1/24 to LAN and 100.64.1.1/24 to OPT1.
    
    \subsection{Setting up \opn}
    \fxnote{TODO}
    
    
    \section{Evaluation of the security policy}
    \fxnote{TODO}
    
    
    \section{Policy implementation in \opn}
    \fxnote{TODO}
    
    
    \section{Test of the configuration}
    \fxnote{TODO}
    
    \section{Final remarks}
    \fxnote{TODO}
\end{document}