\documentclass[draft]{homework}

\usepackage{fixme}
\usepackage{minted}
\usepackage{xspace}

\newcommand{\kat}{Kathar√°\xspace}
\newcommand{\sq}{Squid\xspace}
\newcommand{\vb}{VirtualBox\xspace}


\title{Practical Network Defense - Lab 8}
\subtitle{\sq on ACME co.}
\author{Alessandro Serpi - 1647244}
\date{10 May 2019}


\begin{document}
    \maketitle
    \tableofcontents
    
    
    \pagebreak
    \section{Introduction}
   \fxnote{TODO}
    
    
    \section{\sq installation}
    The assignment was carried out in a local environment.
    
    A new \vb guest running Arch Linux was created.
    Since the configuration was conducted through terminal commands, no graphical interface was added.
    Squid was installed using the default package manager (\mintinline{sh}{pacman -S squid}) and started at boot time through \textit{systemd} (\mintinline{sh}{systemctl enable squid.service}).
    
    The \vb machine needs to be started passing the option \texttt{proxy} to the configuration script \texttt{start\_vms.sh}.
    The executable powers up the necessary virtual machines (firewalls and domain controller) and configures the networks.
    
    
    \section{Forward proxy configuration}
    \fxnote{TODO}
    
    
    \section{Authentication setup}
    \sq-provided \texttt{basic\_ldap\_auth} external program was adopted as the authentication plugin.
    It retrieves user credentials through basic HTTP authentication and forwards them to a LDAP domain controller.
    Therefore, it was necessary to insert a rule in both firewalls that allows LDAP traffic from the proxy to the domain controller.
    
    Since anonymous searches are not allowed, a new computer LDAP account was created for the proxy using the domain controller's web GUI.
    \texttt{basic\_ldap\_auth} uses the aforementioned account (credential are provided with \texttt{-D} and \texttt{-w}) to search for (using the account's common name) and bind to the user-sent credentials.
    If the program replies with \texttt{OK}, the user is inserted in the \texttt{ldap-auth} group thanks to the instruction \mintinline{sh}{acl ldap-auth proxy_auth REQUIRED}.
    
    \texttt{auth\_param basic children 10} states that \sq spawns at most ten instances of the authentication program.
    Since each instance can verify only one request at a time, if many users try to log in simultaneously, some of them may wait a few moments before being able to navigate.
    
    
    \section{Test of the setup}
    The IP address \texttt{100.64.2.5/24} (belonging to the client network) was assigned to a virtual interface of the host and the route \texttt{100.64.0.0/16} was added to the same interface via \texttt{100.64.2.1} (the internal firewall's address in the client network).
    
    A \kat guest was created in the client network.
    When it tried to connect to a web server (either in the private network or in the internet) trough \textit{links}, no page could be reached.
    
    In the host OS, a Mozilla Firefox instance was configured to use \texttt{100.64.6.3} as web proxy.
    When it tried to connect to a web server, the proxy requested user credentials.
    It was possible to navigate only if the inserted username and password corresponded to a valid LDAP user account.
    
    
    \section{Final remarks}
    \fxnote{TODO}
\end{document}
